<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨ç‰Œçµ„ - éº»å°‡è½ç‰Œé«˜æ‰‹æ¸¬é©—</title>
    <style>
        :root { --tile-bg: #fff; --tile-text: #333; --table-green: #1a4a16; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background-color: #0f260d; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .container { background: var(--table-green); padding: 25px; border-radius: 20px; border: 8px solid #5d3a1a; box-shadow: 0 20px 50px rgba(0,0,0,0.6); text-align: center; width: 95%; max-width: 800px; }
        .hand { display: flex; justify-content: center; flex-wrap: wrap; gap: 6px; margin: 30px 0; perspective: 500px; }
        .tile { width: 45px; height: 65px; background: var(--tile-bg); border-radius: 5px; color: var(--tile-text); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; border-bottom: 5px solid #bbb; box-shadow: 2px 2px 5px rgba(0,0,0,0.3); }
        .tile.man { color: #d32f2f; } /* è¬å­ç´…è‰² */
        .tile.tong { color: #1976d2; } /* ç­’å­è—è‰² */
        .tile.tiao { color: #388e3c; } /* æ¢å­ç¶ è‰² */
        .tile.zi { color: #4a148c; }   /* å­—ç‰Œç´«è‰² */
        .tile-sub { font-size: 12px; margin-top: -2px; }
        .controls { margin-top: 25px; display: flex; justify-content: center; gap: 15px; }
        button { padding: 12px 25px; font-size: 18px; cursor: pointer; border: none; border-radius: 50px; font-weight: bold; transition: all 0.2s; box-shadow: 0 4px 0 #888; }
        button:active { transform: translateY(4px); box-shadow: none; }
        .btn-gen { background: #ffcc00; color: #333; }
        .btn-ans { background: #eee; color: #333; }
        #result { margin-top: 25px; font-size: 24px; color: #ffeb3b; font-weight: bold; height: 35px; text-shadow: 1px 1px 2px #000; }
    </style>
</head>
<body>

    <h1 style="margin-bottom: 10px;">ğŸ€„ å…¨ç‰Œçµ„ï¼šè½ç‰Œå¤§æŒ‘æˆ°</h1>
    <p>é™¤äº†èŠ±ç‰Œä»¥å¤–çš„æ‰€æœ‰ç‰Œå‹ã€‚æ‰¾å‡ºé€™ 13 å¼µç‰Œè½ä»€éº¼ï¼Ÿ</p>

    <div class="container">
        <div class="hand" id="hand-display"></div>
        
        <div class="controls">
            <button class="btn-gen" onclick="generateGame()">ä¸‹ä¸€é¡Œ (Random)</button>
            <button class="btn-ans" onclick="showAnswer()">æŸ¥çœ‹è§£ç­” (Answer)</button>
        </div>

        <div id="result"></div>
    </div>

<script>
    // ç‰Œå€¼å®šç¾©ï¼š
    // 11-19: è¬, 21-29: ç­’, 31-39: æ¢
    // 41:æ±, 43:å—, 45:è¥¿, 47:åŒ—, 51:ä¸­, 53:ç™¼, 55:ç™½
    const ALL_TILES = [
        11,12,13,14,15,16,17,18,19, // è¬
        21,22,23,24,25,26,27,28,29, // ç­’
        31,32,33,34,35,36,37,38,39, // æ¢
        41,43,45,47,51,53,55        // å­—
    ];

    const NAMES = {
        11:'ä¸€', 12:'äºŒ', 13:'ä¸‰', 14:'å››', 15:'äº”', 16:'å…­', 17:'ä¸ƒ', 18:'å…«', 19:'ä¹',
        21:'â‘ ', 22:'â‘¡', 23:'â‘¢', 24:'â‘£', 25:'â‘¤', 26:'â‘¥', 27:'â‘¦', 28:'â‘§', 29:'â‘¨',
        31:'1', 32:'2', 33:'3', 34:'4', 35:'5', 36:'6', 37:'7', 38:'8', 39:'9',
        41:'æ±', 43:'å—', 45:'è¥¿', 47:'åŒ—', 51:'ä¸­', 53:'ç™¼', 55:'ç™½'
    };

    let currentHand = [];
    let currentAnswers = [];

    function getTileClass(val) {
        if (val < 20) return 'man';
        if (val < 30) return 'tong';
        if (val < 40) return 'tiao';
        return 'zi';
    }

    function getTileSub(val) {
        if (val < 20) return 'è¬';
        if (val < 30) return 'ç­’';
        if (val < 40) return 'æ¢';
        return 'å­—';
    }

    // æ ¸å¿ƒåˆ¤æ–·ï¼šæ‹†è§£åˆ»å­èˆ‡é †å­
    function canHu(cards) {
        if (cards.length === 0) return true;
        let counts = {};
        cards.forEach(c => counts[c] = (counts[c] || 0) + 1);
        
        let unique = Object.keys(counts).map(Number);
        for (let card of unique) {
            if (counts[card] >= 2) { // å˜—è©¦ç•¶å°‡
                let next = [...cards];
                next.splice(next.indexOf(card), 1);
                next.splice(next.indexOf(card), 1);
                if (checkMian(next)) return true;
            }
        }
        return false;
    }

    function checkMian(cards) {
        if (cards.length === 0) return true;
        cards.sort((a, b) => a - b);
        let first = cards[0];

        // 1. å˜—è©¦çµ„æˆåˆ»å­
        let countFirst = cards.filter(c => c === first).length;
        if (countFirst >= 3) {
            let next = [...cards];
            next.splice(0, 3);
            if (checkMian(next)) return true;
        }

        // 2. å˜—è©¦çµ„æˆé †å­ (å­—ç‰Œä¸èƒ½çµ„é †å­)
        if (first < 40) { 
            let idx2 = cards.indexOf(first + 1);
            let idx3 = cards.indexOf(first + 2);
            // ç¢ºä¿æ˜¯åŒä¸€èŠ±è‰² (ä¾‹å¦‚ 19, 20, 21 ä¸æˆé †)
            if (idx2 !== -1 && idx3 !== -1 && Math.floor(first/10) === Math.floor((first+2)/10)) {
                let next = [...cards];
                next.splice(idx3, 1);
                next.splice(idx2, 1);
                next.splice(0, 1);
                if (checkMian(next)) return true;
            }
        }
        return false;
    }

    function generateGame() {
        document.getElementById('result').innerText = "";
        let valid = false;
        
        while (!valid) {
            let pool = [];
            ALL_TILES.forEach(t => { for(let i=0; i<4; i++) pool.push(t); });
            
            let hand = [];
            for (let i = 0; i < 13; i++) {
                let idx = Math.floor(Math.random() * pool.length);
                hand.push(pool.splice(idx, 1)[0]);
            }
            hand.sort((a,b) => a-b);

            // è¨ˆç®—è½å“ªäº›ç‰Œ
            let answers = [];
            for (let t of ALL_TILES) {
                // æª¢æŸ¥è©²ç‰Œæ˜¯å¦é‚„æœ‰å‰© (å ´ä¸Šæœ€å¤š 4 å¼µ)
                if (hand.filter(c => c === t).length < 4) {
                    if (canHu([...hand, t].sort((a,b)=>a-b))) {
                        answers.push(t);
                    }
                }
            }

            // ç¢ºä¿ï¼šæœ‰è½ç‰Œã€ç›®å‰æ²’èƒ¡ã€è½ç‰Œæ•¸ä¸è¦å¤šåˆ°å¤ªé›¢è­œ (å¢åŠ é›£åº¦)
            if (answers.length > 0 && !canHu(hand) && answers.length < 6) {
                currentHand = hand;
                currentAnswers = answers;
                valid = true;
            }
        }
        renderHand();
    }

    function renderHand() {
        const display = document.getElementById('hand-display');
        display.innerHTML = '';
        currentHand.forEach(t => {
            const div = document.createElement('div');
            div.className = `tile ${getTileClass(t)}`;
            div.innerHTML = `<div>${NAMES[t]}</div><div class="tile-sub">${getTileSub(t)}</div>`;
            display.appendChild(div);
        });
    }

    function showAnswer() {
        if (currentAnswers.length === 0) return;
        const ansStrings = currentAnswers.map(a => `${NAMES[a]}${getTileSub(a)}`);
        document.getElementById('result').innerText = `è½ç‰Œï¼š${ansStrings.join('ã€')}`;
    }

    generateGame();
</script>
</body>
</html>
